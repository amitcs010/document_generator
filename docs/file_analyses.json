[
  {
    "purpose": "Updates or inserts customer lifetime value and order count into the customer scores analytics table.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.customer_scores"
    ],
    "transformations": [
      "Calculates lifetime_value by summing order_amount per customer_id.",
      "Calculates order_count by counting orders per customer_id.",
      "Merges calculated data into analytics.customer_scores, updating existing records or inserting new ones."
    ],
    "business_logic": "Maintain an up-to-date summary of customer lifetime value and order frequency for all customers in an analytics table.",
    "dependencies": [
      "analytics.sales_orders",
      "analytics.customer_scores"
    ],
    "file_name": "sp_update_customer_scores.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_update_customer_scores.sql"
  },
  {
    "purpose": "This stored procedure refreshes the analytics.daily_sales table by truncating existing data and inserting new sales records from the staging.sales_orders table.",
    "source_tables": [
      "staging.sales_orders"
    ],
    "target_tables": [
      "analytics.daily_sales"
    ],
    "transformations": [
      "Truncates the target table before inserting new data, ensuring a full refresh.",
      "Calculates 'order_amount' as the product of 'quantity' and 'price'."
    ],
    "business_logic": "It computes the total amount for each order by multiplying quantity and price, and populates the daily sales aggregate table.",
    "dependencies": [
      "analytics.daily_sales (table)",
      "staging.sales_orders (table)"
    ],
    "file_name": "sp_refresh_daily_sales.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_refresh_daily_sales.sql"
  },
  {
    "purpose": "Creates an incremental sales orders dataset, enriching raw order data with product category information and calculating order amounts.",
    "source_tables": [
      "raw.orders",
      "dim_products"
    ],
    "target_tables": [
      "sales_orders"
    ],
    "transformations": [
      "Calculates order_amount by multiplying quantity and price",
      "Enriches raw order data with product category and sub_category by joining with dim_products",
      "Materialized as an incremental model using order_id as the unique key"
    ],
    "business_logic": "Combines raw order details with product dimension attributes to provide a comprehensive view of sales transactions, including the calculated total monetary value per order line item.",
    "dependencies": [
      "source.raw.orders",
      "model.dim_products"
    ],
    "file_name": "sales_orders.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/sales_orders.sql"
  },
  {
    "purpose": "Creates a dimension table for products by selecting key attributes from a raw products source.",
    "source_tables": [
      "raw.products"
    ],
    "target_tables": [
      "dim_products"
    ],
    "transformations": [
      "Direct column selection/projection",
      "Model materialized as a table"
    ],
    "business_logic": "Extracts product identifiers and descriptive attributes like name, category, sub-category, and list price.",
    "dependencies": [
      "raw.products"
    ],
    "file_name": "dim_products.sql",
    "file_type": "model",
    "file_path": "sql/dbt_models/dim_products.sql"
  },
  {
    "purpose": "Aggregates sales data to summarize customer information including their total revenue and total orders.",
    "source_tables": [
      "sales_orders",
      "raw.customers"
    ],
    "target_tables": [
      "customer_summary"
    ],
    "transformations": [
      "Calculates total revenue and total orders per customer from sales data.",
      "Joins customer demographic details with their aggregated sales performance."
    ],
    "business_logic": "Combines individual customer details with their overall spending habits and order frequency.",
    "dependencies": [
      "sales_orders",
      "raw.customers"
    ],
    "file_name": "customer_summary.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/customer_summary.sql"
  },
  {
    "purpose": "Creates a view summarizing total spend for each customer, identifying those who have spent over a specific threshold.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.vw_top_customers"
    ],
    "transformations": [
      "Calculates the sum of order_amount for each customer_id.",
      "Filters customers to include only those where the total spend exceeds 10,000."
    ],
    "business_logic": "Identifies 'top customers' based on their cumulative spending exceeding a predefined amount.",
    "dependencies": [
      "analytics.sales_orders"
    ],
    "file_name": "vw_top_customers.sql",
    "file_type": "view",
    "file_path": "sql/views/vw_top_customers.sql"
  },
  {
    "purpose": "Creates or replaces a clean sales dataset in the staging schema by selecting and transforming data from the raw sales table.",
    "source_tables": [
      "raw.sales"
    ],
    "target_tables": [
      "staging.sales_clean"
    ],
    "transformations": [
      "Casts order_date to DATE, handling potential errors gracefully using TRY_CAST.",
      "Casts price to NUMBER(10,2), handling potential errors gracefully using TRY_CAST."
    ],
    "business_logic": "Filters out records where order_id is NULL or quantity is not positive (less than or equal to 0).",
    "dependencies": [
      "raw.sales"
    ],
    "file_name": "ctas_create_sales_clean.sql",
    "file_type": "script",
    "file_path": "sql/etl/ctas_create_sales_clean.sql"
  },
  {
    "purpose": "This SQL script joins raw order, customer, and product data to create an enriched view of sales orders.",
    "source_tables": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "target_tables": [
      "No explicit target table (produces a result set)"
    ],
    "transformations": [
      "Performs left joins between orders, customers, and products to enrich order details.",
      "Calculates a new column `order_amount` by multiplying `quantity` and `price`."
    ],
    "business_logic": "Combines transactional order data with customer demographic and product attribute information to provide a holistic view of each sales event and its associated value.",
    "dependencies": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "file_name": "sales_enriched_pipeline.sql",
    "file_type": "script",
    "file_path": "sql/etl/sales_enriched_pipeline.sql"
  }
]