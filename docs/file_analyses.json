[
  {
    "purpose": "Updates or inserts customer lifetime value and order count into a customer scores table based on aggregated sales order data.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.customer_scores"
    ],
    "transformations": [
      "Aggregates sales orders by customer_id",
      "Calculates lifetime_value as the sum of order_amount",
      "Calculates order_count as the total number of orders"
    ],
    "business_logic": "Maintains an up-to-date record of key customer metrics (lifetime value and total orders) by merging sales order aggregates into a dedicated customer scores table, updating existing records and inserting new ones.",
    "dependencies": [
      "analytics.sales_orders",
      "analytics.customer_scores"
    ],
    "file_name": "sp_update_customer_scores.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_update_customer_scores.sql"
  },
  {
    "purpose": "Refreshes the daily sales data by truncating and re-populating the analytics.daily_sales table from staging sales orders.",
    "source_tables": [
      "staging.sales_orders"
    ],
    "target_tables": [
      "analytics.daily_sales"
    ],
    "transformations": [
      "Calculates order_amount as the product of quantity and price."
    ],
    "business_logic": "Populates the daily sales fact table with detailed sales records, including a calculated total order amount for each entry.",
    "dependencies": [
      "analytics.daily_sales (table)",
      "staging.sales_orders (table)"
    ],
    "file_name": "sp_refresh_daily_sales.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_refresh_daily_sales.sql"
  },
  {
    "purpose": "Combines raw order data with product dimensions to create a refined orders dataset including product categories and calculated order amounts.",
    "source_tables": [
      "raw.orders",
      "dim_products"
    ],
    "target_tables": [
      "sales_orders"
    ],
    "transformations": [
      "Joins raw order data with product dimension data on product_id",
      "Calculates total order amount for each line item (quantity * price)",
      "Implements incremental loading based on order_id"
    ],
    "business_logic": "Calculates the total value for each order line item by multiplying quantity and price, and enriches order data with product category information.",
    "dependencies": [
      "dim_products"
    ],
    "file_name": "sales_orders.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/sales_orders.sql"
  },
  {
    "purpose": "Creates a dimension table for products by selecting key attributes from the raw products data.",
    "source_tables": [
      "raw.products"
    ],
    "target_tables": [
      "dim_products"
    ],
    "transformations": [
      "Column selection for product_id, product_name, category, sub_category, and list_price."
    ],
    "business_logic": "Extracts fundamental product information to serve as a product dimension.",
    "dependencies": [
      "source('raw', 'products')"
    ],
    "file_name": "dim_products.sql",
    "file_type": "model",
    "file_path": "sql/dbt_models/dim_products.sql"
  },
  {
    "purpose": "This SQL script generates a summary table by combining customer details with their aggregated order revenue and counts.",
    "source_tables": [
      "sales_orders",
      "raw.customers"
    ],
    "target_tables": [
      "customer_summary"
    ],
    "transformations": [
      "Aggregates total revenue (quantity * price) and total orders for each customer from sales data.",
      "Joins customer information with aggregated order data, preserving all customer records."
    ],
    "business_logic": "Combines customer demographic information with their sales performance metrics, including total revenue and number of orders, from the sales data.",
    "dependencies": [
      "sales_orders",
      "raw.customers"
    ],
    "file_name": "customer_summary.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/customer_summary.sql"
  },
  {
    "purpose": "Identifies and lists customers who have spent more than $10,000 in total.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [],
    "transformations": [
      "Aggregates order amounts by customer",
      "Filters customers based on a total spend threshold"
    ],
    "business_logic": "Customers are classified as 'top' if their cumulative order amount exceeds $10,000.",
    "dependencies": [
      "analytics.sales_orders"
    ],
    "file_name": "vw_top_customers.sql",
    "file_type": "view",
    "file_path": "sql/views/vw_top_customers.sql"
  },
  {
    "purpose": "This SQL script creates a cleaned sales table in the staging schema by selecting, transforming, and filtering data from the raw sales table.",
    "source_tables": [
      "raw.sales"
    ],
    "target_tables": [
      "staging.sales_clean"
    ],
    "transformations": [
      "Casting 'order_date' to a DATE data type.",
      "Casting 'price' to a NUMBER(10,2) data type."
    ],
    "business_logic": "It filters out records where 'order_id' is null or 'quantity' is less than or equal to zero.",
    "dependencies": [
      "raw.sales table"
    ],
    "file_name": "ctas_create_sales_clean.sql",
    "file_type": "script",
    "file_path": "sql/etl/ctas_create_sales_clean.sql"
  },
  {
    "purpose": "Enriches raw sales order data by incorporating customer region and product details, and calculating the total order amount for each order.",
    "source_tables": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "target_tables": [],
    "transformations": [
      "Joins raw order data with customer and product information using LEFT JOINs",
      "Calculates 'order_amount' by multiplying 'quantity' and 'price' for each order",
      "Extracts 'region' from customer data, and 'category' and 'product_name' from product data"
    ],
    "business_logic": "Combines individual sales transactions with relevant customer demographic and product catalog information, and computes the total monetary value for each order line item.",
    "dependencies": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "file_name": "sales_enriched_pipeline.sql",
    "file_type": "script",
    "file_path": "sql/etl/sales_enriched_pipeline.sql"
  }
]