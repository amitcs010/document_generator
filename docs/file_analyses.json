[
  {
    "purpose": "Updates or inserts customer lifetime value and total order count in the customer_scores table based on sales order data.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.customer_scores"
    ],
    "transformations": [
      "Calculates lifetime_value as the sum of order_amount per customer_id.",
      "Calculates order_count as the total number of orders per customer_id.",
      "Aggregates sales data by customer_id."
    ],
    "business_logic": "Aggregates sales order data to compute customer lifetime value and total order count, then uses these metrics to update existing customer scores or insert new ones.",
    "dependencies": [
      "analytics.customer_scores",
      "analytics.sales_orders"
    ],
    "file_name": "sp_update_customer_scores.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_update_customer_scores.sql"
  },
  {
    "purpose": "Refreshes the analytics.daily_sales table by truncating it and inserting calculated sales data from the staging.sales_orders table.",
    "source_tables": [
      "staging.sales_orders"
    ],
    "target_tables": [
      "analytics.daily_sales"
    ],
    "transformations": [
      "Calculates 'order_amount' by multiplying 'quantity' and 'price'."
    ],
    "business_logic": "Populates the daily_sales table with refreshed sales order details, including a calculated total order amount for each line item.",
    "dependencies": [
      "analytics.daily_sales",
      "staging.sales_orders"
    ],
    "file_name": "sp_refresh_daily_sales.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_refresh_daily_sales.sql"
  },
  {
    "purpose": "Creates an incremental model of sales orders, enriching them with product category information and calculating the total order amount.",
    "source_tables": [
      "raw.orders",
      "dim_products"
    ],
    "target_tables": [
      "sales_orders"
    ],
    "transformations": [
      "Joins raw order data with product dimension data based on product_id",
      "Calculates 'order_amount' as the product of quantity and price",
      "Implements incremental loading with 'order_id' as the unique key for updates"
    ],
    "business_logic": "Combines raw transactional order details with categorized product information to provide a comprehensive view of sales at the individual order level, including total value per order.",
    "dependencies": [
      "raw.orders",
      "dim_products"
    ],
    "file_name": "sales_orders.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/sales_orders.sql"
  },
  {
    "purpose": "Creates a dimension table named `dim_products` by selecting core product attributes from the raw `products` source table.",
    "source_tables": [
      "raw.products"
    ],
    "target_tables": [
      "dim_products"
    ],
    "transformations": [
      "Direct column selection from source"
    ],
    "business_logic": "Provides a foundational product dimension with core attributes for analytical use.",
    "dependencies": [
      "raw.products"
    ],
    "file_name": "dim_products.sql",
    "file_type": "model",
    "file_path": "sql/dbt_models/dim_products.sql"
  },
  {
    "purpose": "This SQL script creates a customer summary table by combining customer demographic information with their aggregated order statistics.",
    "source_tables": [
      "sales_orders",
      "raw.customers"
    ],
    "target_tables": [
      "customer_summary"
    ],
    "transformations": [
      "Calculates total revenue and total orders per customer from sales data.",
      "Combines customer demographic details with their aggregated order statistics using a left join."
    ],
    "business_logic": "It consolidates individual customer attributes with their lifetime value metrics (total revenue and order count) from sales transactions.",
    "dependencies": [
      "sales_orders",
      "raw.customers"
    ],
    "file_name": "customer_summary.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/customer_summary.sql"
  },
  {
    "purpose": "Creates a view that identifies and lists customers whose total spending exceeds 10,000.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [],
    "transformations": [
      "Calculates the sum of `order_amount` for each customer",
      "Filters results to include only customers with a total spend greater than 10,000"
    ],
    "business_logic": "Customers are classified as 'top customers' if their accumulated order amount exceeds 10,000.",
    "dependencies": [
      "analytics.sales_orders"
    ],
    "file_name": "vw_top_customers.sql",
    "file_type": "view",
    "file_path": "sql/views/vw_top_customers.sql"
  },
  {
    "purpose": "Creates or replaces a cleaned sales table in the staging schema by selecting, transforming, and filtering data from the raw sales table.",
    "source_tables": [
      "raw.sales"
    ],
    "target_tables": [
      "staging.sales_clean"
    ],
    "transformations": [
      "Casts order_date to DATE type using TRY_CAST for error handling.",
      "Casts price to NUMBER(10,2) type using TRY_CAST for error handling."
    ],
    "business_logic": "Filters out records that have a NULL order_id or a quantity that is not greater than zero.",
    "dependencies": [
      "raw.sales"
    ],
    "file_name": "ctas_create_sales_clean.sql",
    "file_type": "script",
    "file_path": "sql/etl/ctas_create_sales_clean.sql"
  },
  {
    "purpose": "This SQL script enriches raw order data by joining it with customer and product information and calculating the total order amount for each line item.",
    "source_tables": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "target_tables": [],
    "transformations": [
      "Joins raw.orders with raw.customers on customer_id and raw.products on product_id.",
      "Calculates a new column 'order_amount' by multiplying quantity and price."
    ],
    "business_logic": "Order details are combined with corresponding customer region and product attributes, including product name and category, and each order item's total monetary value is computed.",
    "dependencies": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "file_name": "sales_enriched_pipeline.sql",
    "file_type": "script",
    "file_path": "sql/etl/sales_enriched_pipeline.sql"
  }
]