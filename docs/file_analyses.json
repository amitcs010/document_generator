[
  {
    "purpose": "Updates or inserts customer lifetime value and order count into the customer_scores table based on sales order data.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.customer_scores"
    ],
    "transformations": [
      "Calculates lifetime_value by summing order_amount per customer_id.",
      "Calculates order_count by counting orders per customer_id.",
      "Performs an UPSERT (update or insert) into the target table based on customer_id."
    ],
    "business_logic": "Aggregates sales order data to calculate customer lifetime value and order count, then synchronizes these metrics into a dedicated customer scores table.",
    "dependencies": [
      "analytics.customer_scores",
      "analytics.sales_orders"
    ],
    "file_name": "sp_update_customer_scores.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_update_customer_scores.sql"
  },
  {
    "purpose": "This procedure truncates and repopulates the analytics.daily_sales table with refreshed sales order data.",
    "source_tables": [
      "staging.sales_orders"
    ],
    "target_tables": [
      "analytics.daily_sales"
    ],
    "transformations": [
      "Calculates 'order_amount' as the product of 'quantity' and 'price'"
    ],
    "business_logic": "Refreshes the daily sales aggregate data by recalculating order amounts from raw sales orders.",
    "dependencies": [
      "analytics.daily_sales",
      "staging.sales_orders"
    ],
    "file_name": "sp_refresh_daily_sales.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_refresh_daily_sales.sql"
  },
  {
    "purpose": "This SQL model joins raw sales order data with product dimension details to create an enriched sales order dataset, calculating the total order amount.",
    "source_tables": [
      "raw.orders",
      "dim_products"
    ],
    "target_tables": [
      "sales_orders"
    ],
    "transformations": [
      "Joins raw order data with product lookup on product_id.",
      "Calculates 'order_amount' by multiplying 'quantity' and 'price'.",
      "Selects relevant order and product attributes."
    ],
    "business_logic": "Combines transactional order details with static product attributes to provide a comprehensive view of each sales order, including its category, sub-category, and calculated total value.",
    "dependencies": [
      "raw.orders",
      "dim_products"
    ],
    "file_name": "sales_orders.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/sales_orders.sql"
  },
  {
    "purpose": "Extracts core product information from the raw products table into a dimension table.",
    "source_tables": [
      "raw.products"
    ],
    "target_tables": [
      "dim_products"
    ],
    "transformations": [
      "Direct column selection"
    ],
    "business_logic": "This model defines the structure and content for the product dimension by selecting key product attributes.",
    "dependencies": [
      "source:raw.products"
    ],
    "file_name": "dim_products.sql",
    "file_type": "model",
    "file_path": "sql/dbt_models/dim_products.sql"
  },
  {
    "purpose": "This SQL script generates a summary table of customer information, including their total revenue and total orders.",
    "source_tables": [
      "sales_orders",
      "raw.customers"
    ],
    "target_tables": [
      "customer_summary"
    ],
    "transformations": [
      "Aggregates sales data to calculate total revenue and total orders per customer",
      "Joins customer demographic details with their aggregated order statistics"
    ],
    "business_logic": "Combines individual customer details from a raw source with their summarized sales performance data from processed orders.",
    "dependencies": [
      "sales_orders",
      "raw.customers"
    ],
    "file_name": "customer_summary.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/customer_summary.sql"
  },
  {
    "purpose": "Creates a view to identify top customers based on their total spending.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.vw_top_customers"
    ],
    "transformations": [
      "Aggregates order amounts by customer",
      "Filters customers based on total spend"
    ],
    "business_logic": "Identifies top customers as those with a total spend greater than 10,000 units.",
    "dependencies": [
      "analytics.sales_orders"
    ],
    "file_name": "vw_top_customers.sql",
    "file_type": "view",
    "file_path": "sql/views/vw_top_customers.sql"
  },
  {
    "purpose": "This SQL script creates or replaces a cleaned sales table in the staging schema by selecting and transforming data from the raw sales table.",
    "source_tables": [
      "raw.sales"
    ],
    "target_tables": [
      "staging.sales_clean"
    ],
    "transformations": [
      "Converts order_date to a DATE type using TRY_CAST for error handling.",
      "Converts price to a NUMBER(10,2) type using TRY_CAST for error handling."
    ],
    "business_logic": "Filters sales records to include only those with a non-null order_id and a positive quantity.",
    "dependencies": [
      "The 'raw.sales' table must exist.",
      "The 'staging' schema must exist."
    ],
    "file_name": "ctas_create_sales_clean.sql",
    "file_type": "script",
    "file_path": "sql/etl/ctas_create_sales_clean.sql"
  },
  {
    "purpose": "This SQL script enriches raw order data by joining it with customer and product information and calculating the total order amount.",
    "source_tables": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "target_tables": [],
    "transformations": [
      "Joins order, customer, and product data based on IDs.",
      "Calculates 'order_amount' as quantity multiplied by price.",
      "Adds customer region, product category, and product name to order records."
    ],
    "business_logic": "Enriches order details with relevant customer and product attributes, and calculates the monetary value of each order item.",
    "dependencies": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "file_name": "sales_enriched_pipeline.sql",
    "file_type": "script",
    "file_path": "sql/etl/sales_enriched_pipeline.sql"
  }
]