[
  {
    "purpose": "This stored procedure calculates and maintains customer lifetime value and order counts in an analytics table.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.customer_scores"
    ],
    "transformations": [
      "Calculates total order amount (lifetime_value) per customer",
      "Calculates total order count per customer",
      "Upserts (updates or inserts) customer scores into the target table based on customer_id"
    ],
    "business_logic": "Customer lifetime value is the sum of all order amounts, and order count is the total number of orders placed by a customer.",
    "dependencies": [
      "analytics.sales_orders",
      "analytics.customer_scores"
    ],
    "file_name": "sp_update_customer_scores.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_update_customer_scores.sql"
  },
  {
    "purpose": "Refreshes the `analytics.daily_sales` table with the latest sales data from the `staging.sales_orders` table.",
    "source_tables": [
      "staging.sales_orders"
    ],
    "target_tables": [
      "analytics.daily_sales"
    ],
    "transformations": [
      "Calculates `order_amount` by multiplying `quantity` and `price`"
    ],
    "business_logic": "Performs a full refresh of daily sales data, ensuring the target table reflects the current state of sales orders.",
    "dependencies": [
      "staging.sales_orders",
      "analytics.daily_sales"
    ],
    "file_name": "sp_refresh_daily_sales.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_refresh_daily_sales.sql"
  },
  {
    "purpose": "Enriches raw sales order data by joining it with product dimension attributes and calculating the order amount.",
    "source_tables": [
      "raw.orders",
      "dim_products"
    ],
    "target_tables": [
      "sales_orders"
    ],
    "transformations": [
      "Joins raw order data with product dimension information",
      "Calculates order_amount as quantity multiplied by price",
      "Configured for incremental materialization with order_id as the unique key"
    ],
    "business_logic": "Combines individual sales transactions with their corresponding product categories and subcategories to derive the total value of each order line item.",
    "dependencies": [
      "raw.orders",
      "dim_products"
    ],
    "file_name": "sales_orders.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/sales_orders.sql"
  },
  {
    "purpose": "Creates a dimensional product table by selecting core attributes from the raw products source.",
    "source_tables": [
      "raw.products"
    ],
    "target_tables": [
      "dim_products"
    ],
    "transformations": [
      "Selection of specific columns (product_id, product_name, category, sub_category, list_price)",
      "Materialization as a table"
    ],
    "business_logic": "This model defines the structure and content of the product dimension by directly selecting attributes from the raw product data.",
    "dependencies": [
      "raw.products"
    ],
    "file_name": "dim_products.sql",
    "file_type": "model",
    "file_path": "sql/dbt_models/dim_products.sql"
  },
  {
    "purpose": "This SQL script creates a summary table combining customer details with their aggregated order information.",
    "source_tables": [
      "sales_orders",
      "raw.customers"
    ],
    "target_tables": [
      "customer_summary"
    ],
    "transformations": [
      "Aggregating sales orders by customer to calculate total revenue and total orders.",
      "Joining customer details with the aggregated order data using customer_id."
    ],
    "business_logic": "It calculates the total revenue by summing (quantity * price) and total orders by counting line items for each customer, then combines this with customer name and region.",
    "dependencies": [
      "sales_orders",
      "raw.customers"
    ],
    "file_name": "customer_summary.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/customer_summary.sql"
  },
  {
    "purpose": "Creates a view listing customers whose total order amount exceeds $10,000.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.vw_top_customers"
    ],
    "transformations": [
      "Aggregates total order amount for each customer",
      "Filters customers based on a minimum total spend threshold"
    ],
    "business_logic": "Identifies top customers based on their cumulative order amount being greater than $10,000.",
    "dependencies": [
      "analytics.sales_orders"
    ],
    "file_name": "vw_top_customers.sql",
    "file_type": "view",
    "file_path": "sql/views/vw_top_customers.sql"
  },
  {
    "purpose": "This SQL script creates or replaces a cleaned sales table in the staging schema.",
    "source_tables": [
      "raw.sales"
    ],
    "target_tables": [
      "staging.sales_clean"
    ],
    "transformations": [
      "Casting order_date to DATE with error handling (TRY_CAST)",
      "Casting price to NUMBER(10,2) with error handling (TRY_CAST)"
    ],
    "business_logic": "Filters out records with null order_id and records where quantity is not greater than zero.",
    "dependencies": [
      "raw.sales"
    ],
    "file_name": "ctas_create_sales_clean.sql",
    "file_type": "script",
    "file_path": "sql/etl/ctas_create_sales_clean.sql"
  },
  {
    "purpose": "This SQL script enriches raw order data by joining customer and product details and calculating the total order amount.",
    "source_tables": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "target_tables": [],
    "transformations": [
      "Joins raw.orders with raw.customers on customer_id and raw.products on product_id to enrich order details.",
      "Calculates 'order_amount' by multiplying 'quantity' and 'price' from the orders table.",
      "Adds 'region' from customers and 'category', 'product_name' from products to the final dataset."
    ],
    "business_logic": "Integrates sales transactions with customer demographics and product attributes to create a comprehensive, denormalized view of each order, including its calculated total value.",
    "dependencies": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "file_name": "sales_enriched_pipeline.sql",
    "file_type": "script",
    "file_path": "sql/etl/sales_enriched_pipeline.sql"
  }
]