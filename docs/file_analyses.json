[
  {
    "purpose": "Updates or inserts customer lifetime value and order count into a customer scores table based on sales order data.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.customer_scores"
    ],
    "transformations": [
      "Calculates lifetime_value by summing order_amount per customer_id.",
      "Calculates order_count by counting orders per customer_id.",
      "Aggregates data by customer_id."
    ],
    "business_logic": "Customer scores are updated if a customer exists in the scores table, otherwise, a new entry is created with their aggregated lifetime value and order count from sales orders.",
    "dependencies": [
      "analytics.customer_scores",
      "analytics.sales_orders"
    ],
    "file_name": "sp_update_customer_scores.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_update_customer_scores.sql"
  },
  {
    "purpose": "Refreshes the `daily_sales` table in the `analytics` schema by truncating existing data and reloading it from the `staging.sales_orders` table.",
    "source_tables": [
      "staging.sales_orders"
    ],
    "target_tables": [
      "analytics.daily_sales"
    ],
    "transformations": [
      "Calculates `order_amount` as `quantity * price`"
    ],
    "business_logic": "Implements a full refresh strategy for daily sales by clearing the target table before inserting all current sales order records.",
    "dependencies": [
      "analytics.daily_sales",
      "staging.sales_orders"
    ],
    "file_name": "sp_refresh_daily_sales.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_refresh_daily_sales.sql"
  },
  {
    "purpose": "This SQL creates an incremental sales orders fact table by joining raw order data with product dimension details and calculating order amounts.",
    "source_tables": [
      "raw.orders",
      "dim_products"
    ],
    "target_tables": [
      "sales_orders"
    ],
    "transformations": [
      "Joins raw order data with product lookup data based on product_id.",
      "Calculates order_amount by multiplying quantity and price.",
      "Selects relevant order and product attributes for analysis.",
      "Configured for incremental materialization using order_id as the unique key."
    ],
    "business_logic": "It consolidates raw sales order transactions with their respective product categories and calculates the total monetary value for each order item, preparing data for analytical reporting.",
    "dependencies": [
      "raw.orders (dbt source)",
      "dim_products (dbt ref model)"
    ],
    "file_name": "sales_orders.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/sales_orders.sql"
  },
  {
    "purpose": "Extracts product information from the raw products source table to create a dimension table.",
    "source_tables": [
      "raw.products"
    ],
    "target_tables": [
      "dim_products"
    ],
    "transformations": [
      "Direct column selection"
    ],
    "business_logic": "Selects core product attributes without applying specific business rules or calculations.",
    "dependencies": [
      "source:raw.products"
    ],
    "file_name": "dim_products.sql",
    "file_type": "model",
    "file_path": "sql/dbt_models/dim_products.sql"
  },
  {
    "purpose": "This SQL script creates a customer summary table by combining customer details with aggregated order statistics.",
    "source_tables": [
      "sales_orders",
      "raw.customers"
    ],
    "target_tables": [
      "customer_summary"
    ],
    "transformations": [
      "Aggregates sales orders by customer to calculate total revenue and total orders.",
      "Joins customer demographic information with their aggregated order statistics using a LEFT JOIN on customer_id."
    ],
    "business_logic": "It computes the total revenue and order count for each customer based on sales order data and links this to their first name, last name, and region.",
    "dependencies": [
      "sales_orders",
      "raw.customers"
    ],
    "file_name": "customer_summary.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/customer_summary.sql"
  },
  {
    "purpose": "Identifies top customers based on their total spending exceeding a specified threshold.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.vw_top_customers"
    ],
    "transformations": [
      "Calculates the sum of order amounts per customer",
      "Filters customers based on their aggregated total spend"
    ],
    "business_logic": "Customers are deemed 'top' if their cumulative order amount surpasses 10,000.",
    "dependencies": [
      "analytics.sales_orders"
    ],
    "file_name": "vw_top_customers.sql",
    "file_type": "view",
    "file_path": "sql/views/vw_top_customers.sql"
  },
  {
    "purpose": "This SQL script creates or replaces a clean sales table in the staging schema by selecting and transforming data from the raw sales table.",
    "source_tables": [
      "raw.sales"
    ],
    "target_tables": [
      "staging.sales_clean"
    ],
    "transformations": [
      "Casting 'order_date' to DATE using TRY_CAST for error handling.",
      "Casting 'price' to NUMBER(10,2) using TRY_CAST for error handling."
    ],
    "business_logic": "Filters out records where 'order_id' is null or 'quantity' is zero or less, ensuring data quality for sales transactions.",
    "dependencies": [
      "raw.sales"
    ],
    "file_name": "ctas_create_sales_clean.sql",
    "file_type": "script",
    "file_path": "sql/etl/ctas_create_sales_clean.sql"
  },
  {
    "purpose": "This SQL script enriches individual order details by joining them with customer and product information and calculating the total amount for each order item.",
    "source_tables": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "target_tables": [],
    "transformations": [
      "Joins raw.orders with raw.customers on customer_id to add customer region.",
      "Joins raw.orders with raw.products on product_id to add product category and name.",
      "Calculates 'order_amount' by multiplying order quantity and price for each item."
    ],
    "business_logic": "It combines transactional sales data with customer and product master data to provide a unified view of each sales transaction, including customer region and product category, along with the calculated total amount for the item.",
    "dependencies": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "file_name": "sales_enriched_pipeline.sql",
    "file_type": "script",
    "file_path": "sql/etl/sales_enriched_pipeline.sql"
  }
]