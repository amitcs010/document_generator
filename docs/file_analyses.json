[
  {
    "purpose": "This stored procedure updates or inserts customer lifetime value and total order count into a customer scores table.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.customer_scores"
    ],
    "transformations": [
      "Calculates lifetime value (SUM(order_amount)) for each customer.",
      "Calculates total order count (COUNT(*)) for each customer.",
      "Aggregates sales data by customer_id.",
      "Performs an UPSERT (MERGE) operation on the target table based on customer_id matching."
    ],
    "business_logic": "Customer lifetime value and total order count are computed from sales orders and maintained in a dedicated customer scores table, updating existing entries or inserting new ones.",
    "dependencies": [
      "analytics.sales_orders",
      "analytics.customer_scores"
    ],
    "file_name": "sp_update_customer_scores.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_update_customer_scores.sql"
  },
  {
    "purpose": "This procedure refreshes the `daily_sales` table in the `analytics` schema by truncating it and inserting calculated sales data from the `staging.sales_orders` table.",
    "source_tables": [
      "staging.sales_orders"
    ],
    "target_tables": [
      "analytics.daily_sales"
    ],
    "transformations": [
      "Full truncation of the target table `analytics.daily_sales`",
      "Calculation of `order_amount` by multiplying `quantity` and `price`"
    ],
    "business_logic": "The `analytics.daily_sales` table is completely rebuilt to reflect the current state of sales orders, with an `order_amount` calculated for each transaction.",
    "dependencies": [
      "staging.sales_orders",
      "analytics.daily_sales"
    ],
    "file_name": "sp_refresh_daily_sales.sql",
    "file_type": "stored_procedure",
    "file_path": "sql/stored_procedures/sp_refresh_daily_sales.sql"
  },
  {
    "purpose": "This SQL script creates an incremental sales orders fact table by combining raw order data with product dimension information and calculating total order amounts.",
    "source_tables": [
      "raw.orders",
      "dim_products"
    ],
    "target_tables": [
      "sales_orders"
    ],
    "transformations": [
      "Calculates 'order_amount' by multiplying 'quantity' and 'price'.",
      "Enriches order data with 'category' and 'sub_category' from product dimension.",
      "Filters for new or updated records based on 'order_id' for incremental builds (implied by dbt config)."
    ],
    "business_logic": "Combines transactional order details with product master data to provide a comprehensive view of sales transactions, including product categorization and total monetary value per order.",
    "dependencies": [
      "raw.orders",
      "dim_products"
    ],
    "file_name": "sales_orders.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/sales_orders.sql"
  },
  {
    "purpose": "This SQL model extracts core product attributes from a raw source to create a dimension table.",
    "source_tables": [
      "raw.products"
    ],
    "target_tables": [
      "dim_products"
    ],
    "transformations": [
      "Column selection"
    ],
    "business_logic": "Extracts key product descriptive information for a dimension table.",
    "dependencies": [
      "raw.products"
    ],
    "file_name": "dim_products.sql",
    "file_type": "model",
    "file_path": "sql/dbt_models/dim_products.sql"
  },
  {
    "purpose": "This SQL script creates a summary table combining customer details with their aggregated order statistics.",
    "source_tables": [
      "sales_orders",
      "raw.customers"
    ],
    "target_tables": [
      "customer_summary"
    ],
    "transformations": [
      "Aggregates sales orders by customer_id to calculate total revenue and total orders.",
      "Joins customer details with the aggregated order data using a LEFT JOIN."
    ],
    "business_logic": "Summarizes customer purchasing behavior by calculating total revenue and total orders for each customer and combining it with their personal and regional information.",
    "dependencies": [
      "sales_orders",
      "raw.customers"
    ],
    "file_name": "customer_summary.sql",
    "file_type": "script",
    "file_path": "sql/dbt_models/customer_summary.sql"
  },
  {
    "purpose": "This SQL view identifies customers who have spent more than 10,000 in total.",
    "source_tables": [
      "analytics.sales_orders"
    ],
    "target_tables": [
      "analytics.vw_top_customers"
    ],
    "transformations": [
      "Aggregates order amounts by customer",
      "Groups data by customer ID",
      "Filters customers based on total spend exceeding 10,000"
    ],
    "business_logic": "A customer is considered 'top' if their cumulative spending across all orders exceeds a threshold of 10,000.",
    "dependencies": [
      "analytics.sales_orders"
    ],
    "file_name": "vw_top_customers.sql",
    "file_type": "view",
    "file_path": "sql/views/vw_top_customers.sql"
  },
  {
    "purpose": "This SQL script creates or replaces the `staging.sales_clean` table by selecting, transforming, and filtering sales data from `raw.sales`.",
    "source_tables": [
      "raw.sales"
    ],
    "target_tables": [
      "staging.sales_clean"
    ],
    "transformations": [
      "Casting 'order_date' to a DATE datatype, handling potential errors",
      "Casting 'price' to a NUMBER(10,2) datatype, handling potential errors",
      "Filtering out records where 'order_id' is NULL",
      "Filtering out records where 'quantity' is not a positive value"
    ],
    "business_logic": "Only valid sales records with a defined order ID and a positive quantity are included in the cleaned sales data.",
    "dependencies": [
      "raw.sales"
    ],
    "file_name": "ctas_create_sales_clean.sql",
    "file_type": "script",
    "file_path": "sql/etl/ctas_create_sales_clean.sql"
  },
  {
    "purpose": "This SQL script joins orders with customer and product details to enrich sales data and calculate the total order amount.",
    "source_tables": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "target_tables": [],
    "transformations": [
      "Joins orders with customer and product information based on IDs.",
      "Calculates 'order_amount' by multiplying 'quantity' and 'price' for each order."
    ],
    "business_logic": "Combines sales transaction details with customer demographic and product descriptive information to provide a comprehensive view of each sale, including its total value.",
    "dependencies": [
      "raw.orders",
      "raw.customers",
      "raw.products"
    ],
    "file_name": "sales_enriched_pipeline.sql",
    "file_type": "script",
    "file_path": "sql/etl/sales_enriched_pipeline.sql"
  }
]